{"version":3,"file":"back.js","sourceRoot":"","sources":["../../src/back.ts"],"names":[],"mappings":"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","sourcesContent":["export class Back\n{\n\n  public static title(title: string)\n  {\n    document.getElementsByTagName('title')[0].innerHTML = title;\n  }\n\n  public static onIonViewDidLoad(page: any)\n  {\n    page.time = new Date().getTime();\n    page.back = (e: any) => {\n      // 这里获取到的 state 实际上是 popstate 后的 data, so 后面的代码需要替换前一个 state data\n      if (window.history.state.time == page.time) {\n        page.navCtrl.pop().catch((e:any) => console.error(e));\n        // 注销监听\n        window.removeEventListener(\"popstate\", page.back);\n        page.back = null;\n\n        // 处理其他需要操作的事件， 如 dismiss modal\n      }\n    };\n    window.addEventListener(\"popstate\", page.back, false);\n\n    // 设置前一个和将要压入的 state data 数据\n    window.history.replaceState({time: page.time, active: false}, null, null);\n    window.history.pushState({time: page.time, active: true}, null, null);\n  }\n\n  public static onIonViewWillUnload(page: any)\n  {\n    // 注销监听器\n    page.back && window.removeEventListener(\"popstate\", page.back);\n    if (window.history.state.time == page.time && window.history.state.active) {\n      // 如果不是通过 back 回退的，需要手动回退一个状态\n      window.history.back();\n    }\n  }\n}\n\nexport class BasePage\n{\n\n  public title: string = null;\n  public enableBack: boolean = false;\n\n  /**\n   * @param {string} title 标题\n   * @param {boolean} enableBack 是否添加 window.history 会退栈\n   */\n  constructor(\n      title: string = null, enableBack: boolean = false)\n  {\n    this.title = title;\n    this.enableBack = enableBack;\n  }\n\n  ionViewWillEnter()\n  {\n    this.title && Back.title(this.title)\n  }\n\n  setTitle(title: string)\n  {\n    this.title = title;\n    this.title && Back.title(this.title);\n  }\n\n  ionViewDidLoad()\n  {\n    console.log('BasePage::ionViewDidLoad', this.constructor.name);\n    this.enableBack && Back.onIonViewDidLoad(this)\n  }\n\n  ionViewWillUnload()\n  {\n    console.log('BasePage:ionViewWillUnload', this.constructor.name);\n    this.enableBack && Back.onIonViewWillUnload(this)\n  }\n}\n\n"]}